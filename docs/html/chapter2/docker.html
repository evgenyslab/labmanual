

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4. Docker &mdash; LAB Manual  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/drawio.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. AWS" href="aws.html" />
    <link rel="prev" title="3. Development" href="../chapter1/Development.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> LAB Manual
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../chapter1/home.html">1. Labmanual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter1/OSConfigurations.html">2. OS Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter1/Development.html">3. Development</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Docker</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-docker">4.1. What is Docker?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why-is-docker">4.2. Why is Docker?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mechanics">4.3. Mechanics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker-workflow">4.4. Docker Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-simple-linux">4.4.1. Example: Simple Linux</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tips-and-tricks">4.4.1.1. Tips and Tricks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example-simple-python">4.4.2. Example: Simple Python</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#supplementary-references">4.5. Supplementary References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="aws.html">5. AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="opencv.html">6. OpenCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">7. Miscellaneous Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter3/projects.html">8. Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter3/python.html">9. Python Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter3/pytorch.html">10. PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter3/random.html">11. Random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter3/camera.html">12. Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">13. README: LAB MANUAL</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LAB Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="section-number">4. </span>Docker</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/chapter2/docker.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="docker">
<h1><span class="section-number">4. </span>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h1>
<p>This guide provides some background on <code class="code docutils literal notranslate"><span class="pre">docker</span></code>,
including example usages.</p>
<div class="section" id="what-is-docker">
<h2><span class="section-number">4.1. </span>What is Docker?<a class="headerlink" href="#what-is-docker" title="Permalink to this headline">¶</a></h2>
<p>Docker is a software platform that provides
OS-level virtualization-level as <em>containers</em>.</p>
<p>The <em>containers</em> are running instances of <em>images</em>.</p>
<p><em>Images</em> define the based operating system layer required
for the container.</p>
<p>Docker can be seen similar to a virtual machine
service, essentially providing a framework for
starting, running, maintaining, stopping, and
removing OS-level applications.</p>
</div>
<div class="section" id="why-is-docker">
<h2><span class="section-number">4.2. </span>Why is Docker?<a class="headerlink" href="#why-is-docker" title="Permalink to this headline">¶</a></h2>
<p>To provide an os-agnostic virtualization layer for applications.</p>
<p>With docker, creating <em>images</em> and running <em>containers</em> from
images allows developers to write applications regardless
of the host operating system.</p>
<p><em>How?</em></p>
<p>The developer specifies the required os-layer in the <em>image</em>
definition, which can be done through a <em>dockerfile</em>. Then,
docker takes care of the all the backend required to run a
virtualization at an OS level and runs an instance of the
<em>image</em> as a <em>container</em>.</p>
<p>Docker is a very useful tool for providing an OS-abstraction,
allowing developers to create images specifically for
development environments, and deployment environments.</p>
</div>
<div class="section" id="mechanics">
<h2><span class="section-number">4.3. </span>Mechanics<a class="headerlink" href="#mechanics" title="Permalink to this headline">¶</a></h2>
<p><em>Image</em></p>
<blockquote>
<div><p>A definition of the os, os configuration and execution
commands required by the developer.</p>
<p>Docker hosts a repository of many base images that can
be used as a basis for virtualization.</p>
<p>An image can be defined through a <code class="code docutils literal notranslate"><span class="pre">dockerfile</span></code>
which identifies the source os-image to use, and
builds on with added commands, including creation
of specific folders, downloading and installing packages
and running scripts. Finally, the <code class="code docutils literal notranslate"><span class="pre">dockerfile</span></code>
ends with an application entry point.</p>
</div></blockquote>
<p><em>Container</em></p>
<blockquote>
<div><p>A container is an instance of an <em>Image</em>. For example,
a <code class="code docutils literal notranslate"><span class="pre">base-linux</span></code> image will be stored as a docker
<code class="code docutils literal notranslate"><span class="pre">image</span></code>. Once a developer wants to create a running
instance of the image, a <em>container</em> will be created
that specifies the instance of the image, along with
any folder mapping, network interfaces, gpu-linking, etc.</p>
</div></blockquote>
</div>
<div class="section" id="docker-workflow">
<h2><span class="section-number">4.4. </span>Docker Workflow<a class="headerlink" href="#docker-workflow" title="Permalink to this headline">¶</a></h2>
<p>The general docker workflow consists of:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Identify the use-case, either development, deployment</p></li>
<li><p>Pull image, or create image from <code class="code docutils literal notranslate"><span class="pre">dockerfile</span></code></p></li>
<li><p>Instantiate image with required settings (network, folder
mapping, etc)</p></li>
<li><p>Do Work.</p></li>
</ol>
</div></blockquote>
<p><strong>NOTE</strong>: creating a container will execute the docker file commands,
thus if the final command of the container exits, the container
will stop after completion of the last command.</p>
<div class="section" id="example-simple-linux">
<h3><span class="section-number">4.4.1. </span>Example: Simple Linux<a class="headerlink" href="#example-simple-linux" title="Permalink to this headline">¶</a></h3>
<p>In this example, we will create a simple <code class="code docutils literal notranslate"><span class="pre">dockerfile</span></code> with
a base linux image, install some packages, run the image, and then
enter the image and look around.</p>
<p>First, create a file called <code class="code docutils literal notranslate"><span class="pre">dockerfile</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## 1. Create docker file:</span>
touch dockerfile
</pre></div>
</div>
<p>Next, open the docker file and fill in the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get ubuntu 18.04 image:</span>
<span class="n">FROM</span> <span class="n">ubuntu</span><span class="p">:</span><span class="mf">18.04</span>

<span class="c1"># run update:</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>

<span class="c1"># Install ssh with auto &#39;yes&#39;</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">ssh</span>

<span class="c1"># Create dir for sshd to run:</span>
<span class="n">RUN</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">sshd</span>

<span class="c1"># Clean:</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">clean</span>

<span class="c1"># Run SSHD service without detaching</span>
<span class="c1"># this will keep the image alive for us</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;/usr/sbin/sshd&quot;</span><span class="p">,</span> <span class="s2">&quot;-D&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Save the file, then we can build the image using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker build -t ubuntu/base:1.0 -f base-linux .
</pre></div>
</div>
<p>This command tells docker to build the <code class="code docutils literal notranslate"><span class="pre">base-linx</span></code> file from
the current directory (<code class="code docutils literal notranslate"><span class="pre">.</span></code>), and tag it under base <code class="code docutils literal notranslate"><span class="pre">ubuntu</span></code>
with tag <code class="code docutils literal notranslate"><span class="pre">base</span></code> and version <code class="code docutils literal notranslate"><span class="pre">1.0</span></code>.</p>
<p>Once the image is built, we can check the docker images by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker image ls
<span class="c1"># this will return:</span>
$ REPOSITORY     TAG     IMAGE ID    CREATED     SIZE
$ ubuntu/base    <span class="m">1</span>.0     108hjkbas   ....        ...
</pre></div>
</div>
<p>Herein, the image is created locally with an image ID.</p>
<p>Once the image is created, we can instantiate a container from it
that we can play around with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -d --name test_container ubuntu/base:1.0
</pre></div>
</div>
<p>this will create an image and run it in detached mode.
To confirm the image is up
and running, you can do the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># get container report:</span>
docker container ls
<span class="c1"># ^ should return all active containers</span>
<span class="c1"># Get status of exited containers:</span>
docker ps
</pre></div>
</div>
<p>If everything ran correctly, <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">container</span> <span class="pre">ls</span></code> should
show you the running container you created. If the container is
not listed, most likely it existed. To find exited containers,
use the <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span></code> command to list status of all recent
containers.</p>
<p>If you see your container in the <code class="code docutils literal notranslate"><span class="pre">ps</span></code> command, you can
check the docker logs using <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">logs</span></code> to see what
might have caused the container to exit.</p>
<p><strong>Note</strong>, stopping and exiting containers will keep their
names in docker’s memory, therefore, if a container is stopped,
and a new container with the same name is desired, it is
important to remove the stopped container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker container rm container_name
<span class="c1"># Alternatively, use ID:</span>
docker container rm ID
</pre></div>
</div>
<p>With the linux container running, we can now enter the container
and explore it like a regular ssh remote connection.</p>
<p><strong>NOTE</strong> if the container runs an <code class="code docutils literal notranslate"><span class="pre">sshd</span></code> service natively,
then ssh can be used to enter the container. HOWERVER, not all
container run <code class="code docutils literal notranslate"><span class="pre">sshd</span></code> service, therefore, docker can be used
to enter the container as command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it test_container bash
</pre></div>
</div>
<p>As this point, you will enter the container into <code class="code docutils literal notranslate"><span class="pre">bash</span></code> with
root access.</p>
<p>Here, you can run <code class="code docutils literal notranslate"><span class="pre">apt-get</span></code>, or use the container as any
linux OS.</p>
<p>To stop the container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Stop the container:</span>
docker container stop test_container

<span class="c1"># Remove the container to avoid naming conflicts:</span>
docker container rm test_container

<span class="c1"># To remove the image:</span>
docker image rm ID
</pre></div>
</div>
<div class="section" id="tips-and-tricks">
<h4><span class="section-number">4.4.1.1. </span>Tips and Tricks<a class="headerlink" href="#tips-and-tricks" title="Permalink to this headline">¶</a></h4>
<p>When instantiating a container, you can identify which
ports to map between the container and the host,
select the network device, and map any local folders to
the container.</p>
<p>Mapping folders provides the container access to the host
machine’s folders without copying data.</p>
<p>Use the <code class="code docutils literal notranslate"><span class="pre">-p</span> <span class="pre">container_port:host_port</span></code> flag to map
the network ports between the host and the container.</p>
<p>Use the :code: <cite>-v /path/to/local/folder:/path/to/container/folder</cite>
flag to map local folders to container folders.</p>
<p>If the Nvidia-container runtime is installed and
the host machine has gpus available for use, the gpus can
be attached to the container using <code class="code docutils literal notranslate"><span class="pre">--gpus</span> <span class="pre">all</span></code>.</p>
<p>Add the above flags to the <code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command.</p>
</div>
</div>
<div class="section" id="example-simple-python">
<h3><span class="section-number">4.4.2. </span>Example: Simple Python<a class="headerlink" href="#example-simple-python" title="Permalink to this headline">¶</a></h3>
<p>In this example, we will use a <code class="code docutils literal notranslate"><span class="pre">jupyter-lab</span></code> docker image.
We will pull the image using command line, instantiate it into a
container, and then use Jupyter-lab on the host machine through a
web browser.</p>
<p>TODO.</p>
</div>
</div>
<div class="section" id="supplementary-references">
<h2><span class="section-number">4.5. </span>Supplementary References<a class="headerlink" href="#supplementary-references" title="Permalink to this headline">¶</a></h2>
<p>TODO</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="aws.html" class="btn btn-neutral float-right" title="5. AWS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../chapter1/Development.html" class="btn btn-neutral float-left" title="3. Development" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Evgeny.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>